!function(t){"use strict";var i={};t.badyoo=i,i.registerClass=function(t,s){t.__class=s,i[s]=t};class s{constructor(t,s){this.index=0,this.Uindex=0,this.program=i.current.createProgram(t,s)}bind(){i.current.gl.useProgram(this.program)}AttribLocation(t){this["a_"+this.index++]=i.current.gl.getAttribLocation(this.program,t)}AttriUniformLocation(t){this["u_"+this.Uindex++]=i.current.gl.getUniformLocation(this.program,t)}uploadAttrib(t,s,e,r=!1,a=0,h=0){i.current.gl.enableVertexAttribArray(this["a_"+t]),i.current.gl.vertexAttribPointer(this["a_"+t],s,e,r,a,h)}uploadUniform2f(t,s,e){this["u_"+t]&&i.current.gl.uniform2f(this["u_"+t],s,e)}uploadUniform1f(t,s){this["u_"+t]&&i.current.gl.uniform1f(this["u_"+t],s)}}i.registerClass(class{constructor(){this.debug=!0,this.root=null,this.randerList=[],this.tList=[],this.G_a=this.G_r=this.G_g=this.G_b=0,this.G_m=new r,this.G_tp=new e}init(e,r,h,o,n){var l=this;if(l.window=t,l.canvas=n,l.alignC=o,null==l.canvas){l.canvas=t.document.createElement("canvas");var u=l.canvas.style;u.position="absolute",u.top=u.left="0px",u.background="#000000",t.document.body.appendChild(l.canvas)}if(l.width=l.canvas.width=t.innerWidth,l.height=l.canvas.height=t.innerHeight,e&&(l.width=e),r&&(l.height=r),l.gl=l.canvas.getContext("webgl",{antialias:!1,premultipliedAlpha:!0}),l.gl){console.warn("init w:"+l.width+" h:"+l.height),l.root=null==h?new p:new h,l.root.width=l.width,l.root.height=l.height,i.root=l.root;var d="attribute vec4 a_position;\n            uniform vec2 u_re;\n            uniform vec2 u_offest;\n            varying vec2 v_texCoord;\n            void main() {\n                v_texCoord = a_position.zw;\n                vec2 temp = a_position.xy * u_re + u_offest;\n                gl_Position = vec4(temp.x,-temp.y,0,1);\n            }",m=l.gl.canvas.width/l.width;l.gl.canvas.height<l.gl.canvas.width&&(m=l.gl.canvas.height/l.height),l.G_m.set(m,0,0,m,0,0);var c,_,g=2/l.gl.canvas.width*l.G_m.a,x=2/l.gl.canvas.height*l.G_m.d,f=0;0==l.alignC&&(c=(l.gl.canvas.width-l.width*l.G_m.a)/l.gl.canvas.width-1,f=(l.gl.canvas.height-l.height*l.G_m.d)/l.gl.canvas.height-1,l.G_m.tx=l.gl.canvas.width-l.width*l.G_m.a>>1,l.G_m.ty=l.gl.canvas.height-l.height*l.G_m.d>>1),(_=new s(d,"\n            precision mediump float;\n            varying vec2 v_texCoord;\n            uniform sampler2D u_texture;\n            uniform float u_alpha;\n            void main(){\n                gl_FragColor = texture2D(u_texture, v_texCoord)*u_alpha;\n            }")).AttribLocation("a_position"),_.AttriUniformLocation("u_re"),_.AttriUniformLocation("u_offest"),_.AttriUniformLocation("u_alpha"),_.bind(),_.uploadUniform2f(0,g,x),_.uploadUniform2f(1,c,f),l.spriteAProgram=_,(_=new s(d,"\n            precision mediump float;\n            varying vec2 v_texCoord;\n            uniform sampler2D u_texture;\n            void main(){\n                //vec4 temp = texture2D(u_texture, v_texCoord);\n                //float l = 0.299*temp.r+0.587*temp.g+0.114*temp.b;\n                //gl_FragColor = vec4(l,l,l,temp.a);\n                gl_FragColor = texture2D(u_texture, v_texCoord);\n                \n            }")).AttribLocation("a_position"),_.AttriUniformLocation("u_re"),_.AttriUniformLocation("u_offest"),_.bind(),_.uploadUniform2f(0,g,x),_.uploadUniform2f(1,c,f),l.spriteProgram=_,l.indexBuffer=l.createIndexBuffer(16384),l.posionList=new Float32Array(new ArrayBuffer(1048576));for(var v=0;v<=360;v++){var y=v*Math.PI/180;a.sin[v]=Number(Math.sin(y).toFixed(8)),a.cos[v]=Number(Math.cos(y).toFixed(8))}l.time=Date.now();var T=t;for(var L in T.requestAnimationFrame=T.requestAnimationFrame||T.webkitRequestAnimationFrame||T.mozRequestAnimationFrame||T.oRequestAnimationFrame||T.msRequestAnimationFrame,T.requestAnimationFrame(function t(i){var s=Date.now();l.time=s,l.update(),T.requestAnimationFrame(t)}),l.tListType={mousedown:"onTouchDown",mouseup:"onTouchUp",mouseout:"onTouchOut",mousemove:"onTouchMove",touchstart:"onTouchDown",touchend:"onTouchUp",touchcancel:"onTouchOut",touchmove:"onTouchMove"},l.tListType)l.canvas.addEventListener(L,b)}else console.error("webgl Not Supported!");function b(t){if(t.preventDefault(),t.changedTouches)for(var i=t.changedTouches,s=0;s<i.length;s++){var e=i[s];e.type=t.type,l.tList.push(e)}else l.tList.push(t)}}createIndexBuffer(t){t>16384&&(t=16384);for(var i=new ArrayBuffer(2*t*6),s=new Uint16Array(i),e=0;e<t;e++){var r=6*e,a=4*e;s[r++]=a,s[r++]=a+1,s[r++]=a+2,s[r++]=a+2,s[r++]=a+1,s[r++]=a+3}var h=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,h),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,s,this.gl.STATIC_DRAW),h}createAttachShader(t,i){var s=this.gl.createShader(t);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))return s;this.debug&&console.log(this.gl.getShaderInfoLog(s)),this.gl.deleteShader(s)}createProgram(t,i){var s=this.createAttachShader(this.gl.VERTEX_SHADER,t),e=this.createAttachShader(this.gl.FRAGMENT_SHADER,i),r=this.gl.createProgram();if(this.gl.attachShader(r,s),this.gl.attachShader(r,e),this.gl.linkProgram(r),this.gl.getProgramParameter(r,this.gl.LINK_STATUS))return r;this.debug&&console.log(this.gl.getProgramInfoLog(r)),this.gl.deleteProgram(r)}uploadTexture(t){var i=this.gl,s=i.createTexture();return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s}onTouch(){for(var t=this.tList.length,i=0;i<t;i++){var s=this.tList[i],e=s.identifier||0;this.G_tp.setTo(s.pageX||s.clientX,s.pageY||s.clientY),this.root.fromParentPoint(this.G_tp,this.G_m),this.touchEvent(this.root,this.G_tp.x,this.G_tp.y,e,this.tListType[s.type])}this.tList.length=0}touchEvent(t,i,s,a,o){var n=h.get(e),l=(h.get(r),t.displayList),u=t.displayNum;if(n.x=i,n.y=s,t.fromParentPoint(n),0==t.visible&&0==t.touchEnabled)return!1;for(var d=u-1;d>=0;d--){var m=l[d];if(this.touchEvent(m,n.x,n.y,a,o))break}return n.x>=0&&n.x<=t.width&&n.y>=0&&n.y<=t.height&&t[o]?(t[o].call(t,i,s,a),!0):void 0}updateSprite(){for(var t=Date.now(),i=0,s=g.pool.length;i<s;i++){var e=g.pool[i];if(e.loaded&&0==e.m_stop){var r=(t-e.lastTime)/e.interval|0;r&&e.gotoAndPlay(e.currentFrame+r)}}}update(){this.updateSprite(),this.onTouch(),l.m_loop(),this.resetRender(),this.gl.clearColor(this.G_r,this.G_g,this.G_b,this.G_a),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.transform(this.root,this.root.alpha,this.root.matrix),this.randerList.push([this.drawNum,this.drawStart,this.G_texture,this.G_NBlendMode,this.G_alpha]),this.drawNum=0;var t=this.positionBuffer;null==t&&(this.positionBuffer=t=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.posionList,this.gl.STATIC_DRAW),this.spriteAProgram.bind(),this.spriteAProgram.uploadAttrib(0,4,this.gl.FLOAT),this.spriteProgram.bind(),this.spriteProgram.uploadAttrib(0,4,this.gl.FLOAT),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var i=0;i<this.randerList.length;i++)this.render(this.randerList[i])}transform(t,i,s){for(var e=this.posionList,a=t.displayList,o=t.displayNum,n=(i=t.alpha*i,0);n<o;n++){var l=a[n],u=l.alpha*i,d=l.matrix,m=h.get(r);if(m.set(s.a*d.a+s.c*d.b,s.b*d.a+s.d*d.b,s.a*d.c+s.c*d.d,s.b*d.c+s.d*d.d,s.tx+s.a*d.tx+s.c*d.ty,s.ty+s.b*d.tx+s.d*d.ty),l.visible&&0!==u)if(l.displayList)this.transform(l,u,m);else if(l.m_texture){(null!=this.G_texture&&this.G_texture!=l.m_texture.tex||null!=this.G_blendMode&&l.blendMode!=this.G_blendMode||u!=this.G_alpha)&&(this.randerList.push([this.drawNum,this.drawStart,this.G_texture,this.G_NBlendMode,this.G_alpha]),this.drawStart+=2*this.drawNum,this.drawNum=0),this.G_texture=l.m_texture.tex,this.G_NBlendMode=l.blendMode,this.G_alpha=u;var c=l.width,p=l.height,_=m.tx,g=m.ty,x=m.a*c,f=m.b*c,v=m.c*p,y=m.d*p;e[this.index++]=_,e[this.index++]=g,e[this.index++]=l.m_texture.uv[0],e[this.index++]=l.m_texture.uv[1],e[this.index++]=_+x,e[this.index++]=g+f,e[this.index++]=l.m_texture.uv[2],e[this.index++]=l.m_texture.uv[3],e[this.index++]=_+v,e[this.index++]=g+y,e[this.index++]=l.m_texture.uv[4],e[this.index++]=l.m_texture.uv[5],e[this.index++]=_+x+v,e[this.index++]=g+f+y,e[this.index++]=l.m_texture.uv[6],e[this.index++]=l.m_texture.uv[7],this.drawNum+=6}m.i(),h.set(r,m)}}resetRender(){this.randerList.length=0,this.G_texture=null,this.G_program=null,this.G_alpha=1,this.batch=0,this.drawNum=0,this.drawStart=0,this.index=0}render(t){if(0!=t[0]){this.G_alpha=t[4],this.G_texture=t[2],this.G_blendMode!=t[3]&&(this.G_blendMode=t[3],this.gl.enable(this.gl.BLEND),u["b"+this.G_blendMode](this.gl));var i=1!=this.G_alpha?this.spriteAProgram:this.spriteProgram;i.bind(),i.uploadUniform1f(2,this.G_alpha),this.gl.bindTexture(this.gl.TEXTURE_2D,this.G_texture),this.gl.drawElements(this.gl.TRIANGLES,t[0],this.gl.UNSIGNED_SHORT,t[1]),this.batch++}}},"BYGL");class e{constructor(t=0,i=0){this.x=t,this.y=i}setTo(t,i){this.x=t,this.y=i}distance(t,i){var s=t-this.x,e=i-this.y;return Math.sqrt(s*s+e*e)}}i.registerClass(e,"Point");class r{constructor(){this.i()}set(t=1,i=0,s=0,e=1,r=0,a=0){this.a=t,this.b=i,this.c=s,this.d=e,this.tx=r,this.ty=a}i(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}t(t,i){this.tx+=t,this.ty+=i}r(t){var i=a.cos[t],s=a.sin[t];this.a*=i,this.b*=-s,this.c*=s,this.d*=i}s(t,i){this.a*=t,this.b*=t,this.c*=i,this.d*=i,this.tx*=t,this.ty*=i}invert(){var t=this.a,i=this.b,s=this.c,e=this.d,r=this.tx,a=t*e-i*s;return this.a=e/a,this.b=-i/a,this.c=-s/a,this.d=t/a,this.tx=(s*this.ty-e*r)/a,this.ty=-(t*this.ty-i*r)/a,this}}i.registerClass(r,"Matrix");class a{static random(t,i){return(Math.random()*(i-t)|0)+t}}a.cos={},a.sin={},i.registerClass(a,"Maths");class h{static get(t){var i=t.__class,s=(h.dr[i]||(h.dr[i]=[])).pop();return null==s?new t:s}static set(t,i){var s=t.__class;(h.dr[s]||(h.dr[s]=[])).push(i)}}h.dr={},i.registerClass(h,"Pool");class o{run(){if(null!=this.callback){var t=null;return t=arguments.length?this.callback.apply(this.pointer,this.args?this.args.concat(arguments):arguments):this.callback.apply(this.pointer,this.args),this.one&&this.free(!0),t}}free(t=!1){this.args=this.callback=this.pointer=null,t&&h.set(o,this)}static create(t,i,s,e=!0){var r=h.get(o);return r.pointer=t,r.callback=i,r.args=s,r.one=e,r}}i.registerClass(o,"Handler");class n{constructor(){this.arr=[],this.num=0}free(){delete l.updateDir[this.pointer.BadyooLoopIdx],this.pointer.BadyooLoopIdx=null,this.pointer=null,this.num=0,this.arr.length=0,h.set(n,this)}}i.registerClass(n,"LoopData");class l{static update(t,i){var s;null==t.BadyooLoopIdx&&((s=h.get(n)).pointer=t,t.BadyooLoopIdx=l.loopIdx++,l.updateDir[t.BadyooLoopIdx]=l.updateList[l.updateNum]=s,l.updateNum++),-1==(s=l.updateDir[t.BadyooLoopIdx]).arr.indexOf(i)&&(s.arr.push(i),s.num++)}static m_loop(){for(var t=0;t<l.updateNum;t++){var i=l.updateList[t],s=i.arr.length;if(0!=i.num)for(var e=0;e<s;e++)0==i.arr[e]?(i.arr.splice(e,1),s--,e--):i.arr[e].call(i.pointer);else i.free(),l.updateList.splice(t,1),l.updateNum--,t--}}static clearUpdate(t,i){if(null!=t.BadyooLoopIdx){var s=l.updateDir[t.BadyooLoopIdx],e=s.arr.indexOf(i);-1!=e&&(s.arr.splice(e,1,0),s.num--)}}static clearAll(t){if(null!=t.BadyooLoopIdx){var i=l.updateDir[t.BadyooLoopIdx],s=l.updateList.indexOf(i);-1!=s&&(i.free(),l.updateList.splice(s,1),l.updateNum--)}}}l.loopIdx=0,l.updateList=[],l.updateDir={},l.updateNum=0,i.registerClass(l,"Loop");class u{static b0(t){t.blendFunc(t.ONE,t.ZERO)}static b1(t){t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)}static b2(t){t.blendFunc(t.ONE,t.DST_ALPHA)}static b3(t){t.blendFunc(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA)}static b4(t){t.blendFunc(t.ONE,t.ONE)}static b5(t){t.blendFunc(t.ZERO,t.ZERO)}}u.NONE=0,u.NORMAL=1,u.ADD=2,u.MULTIPLY=3,u.SCREEN=4,u.ERASE=5,i.registerClass(u,"BlendMode");class d{constructor(){this.m_x=0,this.m_y=0,this.width=0,this.height=0,this.alpha=1,this.m_pivotX=0,this.m_pivotY=0,this.m_rotation=0,this.m_scaleX=1,this.m_scaleY=1,this.visible=!0,this.blendMode=u.NORMAL,this.parent=null,this.m_matrix=h.get(r),this.touchEnabled=!1,this.m_matrixChange=!1}get x(){return this.m_x}set x(t){this.m_x!=t&&(this.m_x=t,this.m_matrixChange=!0)}get y(){return this.m_y}set y(t){this.m_y!=t&&(this.m_y=t,this.m_matrixChange=!0)}get pivotX(){return this.m_pivotX}set pivotX(t){this.m_pivotX!=t&&(this.m_pivotX=t,this.m_matrixChange=!0)}get pivotY(){return this.m_pivotY}set pivotY(t){this.m_pivotY!=t&&(this.m_pivotY=t,this.m_matrixChange=!0)}get scaleX(){return this.m_scaleX}set scaleX(t){this.m_scaleX!=t&&(this.m_scaleX=t,this.m_matrixChange=!0)}get scaleY(){return this.m_scaleY}set scaleY(t){this.m_scaleY!=t&&(this.m_scaleY=t,this.m_matrixChange=!0)}set rotation(t){this.m_rotation!=t&&(this.m_rotation=t,this.m_matrixChange=!0)}get rotation(){return this.m_rotation}get matrix(){return this.m_matrixChange&&this.updateMatrix(),this.m_matrix}set matrix(t){this.m_matrix=t}pivot(t,i){this.m_pivotX==t&&this.m_pivotY==i||(this.m_pivotX=t,this.m_pivotY=i,this.m_matrixChange=!0)}scale(t,i){this.m_scaleX==t&&this.m_scaleY==i||(this.m_scaleX=t,this.m_scaleY=i,this.m_matrixChange=!0)}updateMatrix(){var t=this.m_rotation;if(0==t)this.m_matrix.set(this.m_scaleX,0,0,this.m_scaleY,this.m_x-this.m_scaleX*this.m_pivotX,this.m_y-this.m_scaleY*this.m_pivotY);else{(t%=360)<0&&(t+=360);var i=a.cos[t],s=a.sin[t];this.m_matrix.a=this.m_scaleX*i,this.m_matrix.b=this.m_scaleX*s,this.m_matrix.c=this.m_scaleY*-s,this.m_matrix.d=this.m_scaleY*i,this.m_matrix.tx=this.m_x-this.m_pivotX*this.m_matrix.a-this.m_pivotY*this.m_matrix.c,this.m_matrix.ty=this.m_y-this.m_pivotX*this.m_matrix.b-this.m_pivotY*this.m_matrix.d}}toParentPoint(t){var i=this.matrix,s=i.a*t.x+i.c*t.y+i.tx,e=i.b*t.x+i.d*t.y+i.ty;return t.x=s,t.y=e,t}fromParentPoint(t,i){null==i&&(i=this.matrix);var s=h.get(r);s.set(i.a,i.b,i.c,i.d,i.tx,i.ty),s.invert();var e=s.a*t.x+s.c*t.y+s.tx,a=s.b*t.x+s.d*t.y+s.ty;return t.x=e,t.y=a,t}localToGlobal(t,s=!1,r=null){!0===s&&(t=h.get(e).setTo(t.x,t.y));var a=this;for(r=r||i.current.root;a&&a!=r;)t=a.toParentPoint(t),a=a.parent;return t}globalToLocal(t,s=!1,r=null){!0===s&&(t=h.get(e).setTo(t.x,t.y));var a=this;r=r||i.current.root;for(var o=[];a&&a!=r;)o.push(a),a=a.parent;for(var n=o.length-1;n>=0;)t=(a=o[n]).fromParentPoint(t),n--;return t}hitTest(t){return 0!=this.width&&0!=this.height&&(t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.x<=this.y+this.height)}hitTestObject(t){return!(t.x+t.width<this.x||t.y+t.height<this.y||t.x>this.x+this.width||t.y>this.y+this.height)}move(t,i){this.x=t,this.y=i}updateTouchEnabled(){this.touchEnabled=this.m_onTouchMove||this.m_onTouchDown||this.m_onTouchUp||this.m_onTouchOut}get onTouchDown(){return this.m_onTouchDown}set onTouchDown(t){this.m_onTouchDown=t,this.updateTouchEnabled()}get onTouchMove(){return this.m_onTouchMove}set onTouchMove(t){this.m_onTouchMove=t,this.updateTouchEnabled()}get onTouchUp(){return this.m_onTouchUp}set onTouchUp(t){this.m_onTouchUp=t,this.updateTouchEnabled()}get onTouchOut(){return this.m_onTouchOut}set onTouchOut(t){this.m_onTouchOut=t,this.updateTouchEnabled()}free(){this.parent&&this.parent.removeChild(this)}}i.registerClass(d,"GameObject");class m{constructor(){this.url="",this.type="",this.handler=null}load(i,s){var e=this;e.type="image",e.url=i,e.handler=s;var r=new t.Image;r.src=this.url,r.crossOrigin="",r.onload=function(){r.onerror=r.onload=null,e.onloaded(r)},r.onerror=function(){r.onerror=r.onload=null,e.onloaded(null)}}httpRequet(t,i,s,e="get",r="text"){var a=this;a.type="httpRequet",a.url=i,a.handler=s;var h=new XMLHttpRequest;h.open(e,i,!0),h.responseType=r,h.setRequestHeader("Content-Type","application/json"),null!=t&&"string"!=typeof t||h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),"arraybuffer"!==(r="arraybuffer")&&(r="text"),h.dataType&&(h.dataType=r),h.onerror=function(t){h.onerror=h.onload=h.onabort=null,a.onloaded(h)},h.onabort=function(t){h.onerror=h.onload=h.onabort=null,a.onloaded(h)},h.onload=function(t){h.onerror=h.onload=h.onabort=null,a.onloaded(h)},h.send(t)}onloaded(t){if(t){if("image"==this.type){var i=new c(t);i.url=this.url,m.assets[this.url]=i}else{var s=t,e=void 0!==s.status?s.status:200;200===e||204===e||0===e?m.assets[this.url]=s.response||s.responseText:console.error("["+s.status+"]"+s.statusText+":"+s.responseURL)}if("atlas"==this.type)return void this.parse(m.assets[this.url]);this.onLoadCall()}else console.log("load error url:"+this.url)}parse(t){var i=m.assets[this.url]=JSON.parse(t);i.meta&&i.meta.image&&m.load(i.meta.image,o.create(this,this.parseDone))}parseDone(t){var i=m.assets[this.url];i.url=this.url;var s=this.url.split(".")[0],e=g.AniPool[this.url]={};for(var r in i.frames){var a=i.frames[r],h=new c(t),o=a.frame.x/h.width,n=a.frame.y/h.height,l=o+a.frame.w/h.width,u=n+a.frame.h/h.height;a.rotated?(h.uv[0]=l,h.uv[1]=n,h.uv[2]=l,h.uv[3]=u,h.uv[4]=o,h.uv[5]=n,h.uv[6]=o,h.uv[7]=u):(h.uv[0]=o,h.uv[1]=n,h.uv[2]=l,h.uv[3]=n,h.uv[4]=o,h.uv[5]=u,h.uv[6]=l,h.uv[7]=u),h.url=s+"/"+r;var d=r.slice(0,r.length-4);(e[d]||(e[d]=[])).push(h.url),h.width=a.sourceSize.w,h.height=a.sourceSize.h,c.atlas[h.url]=h}this.onLoadCall()}onLoadCall(){if(null!=this.handler.length){for(var t=this.handler.length,i=0;i<t;i++)this.handler[i].run(m.assets[this.url]);this.handler.length=0}else this.handler.run(m.assets[this.url]);this.handler=null,this.url="",this.type="",h.set(m,this),delete m.pool[this.url]}static load(t,i,s){if(null!=t)if(c.atlas[t])i.run(c.atlas[t]);else if(m.assets[t])i.run(m.assets[t]);else{var e=m.pool[t];e?e.handler instanceof Array?e.handler.push(i):e.handler=[e.handler,i]:(e=m.pool[t]=h.get(m),t.lastIndexOf(".json")>-1?e.httpRequet(null,t,i):e.load(t,i),null!=s&&(e.type=s))}}static getRES(t){return m.pool[t]}}m.pool={},m.assets={},i.registerClass(m,"Loader");class c{constructor(t){this.width=t.width,this.height=t.height,this.uv=[0,0,1,0,0,1,1,1],this.tex=t instanceof c==0?i.current.uploadTexture(t):t.tex}}c.atlas={},i.registerClass(c,"Texture");class p extends d{constructor(){super(),this.displayList=[],this.displayNum=0,this.touchEnabled=!0}Instantiate(t){var i=new t;return i instanceof d&&this.addChild(i),i}get numChildren(){return this.displayNum}contains(t){return-1!=this.displayList.indexOf(t)}addChild(t){this.addChildAt(t,this.displayNum)}addChildAt(t,i){if(!(i>=0&&i<=this.displayNum))throw new RangeError("Invalid child index");t.parent==this?this.setChildIndex(t,i):i==this.displayNum?this.displayList[this.displayNum++]=t:this.displayList.splice(i,0,t),t.parent=this}removeChild(t){var i=this.displayList.indexOf(t);-1!=i&&(this.displayList.splice(i,1),this.displayNum--,t.parent=null)}removeChildAt(t){if(t>=0&&t<this.displayNum){var i=this.displayList[t];this.displayList.splice(t,1),this.displayNum--,i.parent=null}}removeAllChild(t=0,i=-1){(i<0||i>=this.displayNum)&&(i=this.displayNum-1);for(var s=t;s<=i;s++)this.removeChildAt(t)}getChildAt(t){if(t>=0&&t<this.displayNum)return this.displayList[t];throw new Error("Invalid child index")}getChildByName(t){for(var i=0;i<this.displayNum;i++)if(this.displayList[i].name==t)return this.displayList[i];return null}getChildIndex(t){return this.displayList.indexOf(t)}setChildIndex(t,i){var s=this.displayList.indexOf(t);if(s!=i){if(-1==s)throw new Error("Not a child of this layer");this.displayList.splice(s,1),this.displayList.splice(i,0,t)}}}i.registerClass(p,"Layer");class _ extends d{constructor(){super(),this.loaded=!1}set skin(t){this.loaded=!1,this.m_skin=t,m.load(this.m_skin,o.create(this,this.skinLoaded))}get skin(){return this.m_skin}skinLoaded(t){t.url==this.m_skin&&(this.texture=t,this.loaded=!0)}set texture(t){this.m_texture=t}get texture(){return this.m_texture}get width(){return this.m_width||this.m_texture&&this.m_texture.width}set width(t){this.m_width=t}get height(){return this.m_height||this.m_texture&&this.m_texture.height}set height(t){this.m_height=t}free(){this.m_texture=null,this.loaded=!1,super.free()}}i.registerClass(_,"Image");class g extends _{constructor(){super(),this.fps=30,this.currentFrame=0,this.totalframes=0,this.currentAnimation="",this.loop=!0,this.m_frames=null,this.m_stop=!1,g.pool.push(this)}set fps(t){this.m_fps=t,this.interval=1e3/t}get fps(){return this.m_fps}set skin(t){this.m_skin=t,this.loaded=!1,m.load(this.m_skin,o.create(this,this.skinLoaded),"atlas")}get skin(){return this.m_skin}skinLoaded(t){t.url==this.m_skin&&(this.loaded=!0,""!=this.currentAnimation&&this.playAni(this.currentAnimation))}playAni(t){this.currentAnimation=t,this.totalframes=this.currentFrame=0,this.loaded&&(this.m_frames=g.AniPool[this.m_skin][this.currentAnimation],this.m_frames&&(this.totalframes=this.m_frames.length,this.m_stop?this.gotoAndStop(1):this.gotoAndPlay(1)))}play(){this.m_stop=!1,this.lastTime=Date.now()}stop(){this.m_stop=!0,this.lastTime=0}gotoAndStop(t){t>0&&(t>this.totalframes&&(this.loop?t%=this.totalframes:t=this.totalframes),this.currentFrame=t,this.stop(),this.texture=c.atlas[this.m_frames[this.currentFrame-1]])}gotoAndPlay(t){t>0&&(t>this.totalframes&&(this.loop?t%=this.totalframes:t=this.totalframes),this.currentFrame=t,this.play(),this.texture=c.atlas[this.m_frames[this.currentFrame-1]])}free(){g.pool.splice(g.pool.indexOf(this),1),super.free()}}g.AniPool={},g.pool=[],i.registerClass(g,"Sprite");class x extends d{constructor(){super(),this.m_text="",this.m_textWidth=0,this.m_textHeight=0,this.m_spacing=0,this.m_lineHeight=0,this.m_spaceWidth=10,this.m_font="",this.m_align="left",this.m_valign="top",this.loaded=!1,this.displayList=[],this.displayNum=0,this.touchEnabled=!0}get font(){return this.m_font}set font(t){this.m_font=t}get text(){return this.m_text}set text(t){t!=this.m_text&&(null==t&&(t=""),this.updateText(t))}get textWidth(){return this.m_textWidth}get textHeight(){return this.m_textHeight}updateText(t){null!=t&&(this.m_text=t);var i=0,s=this.displayList.length,e=0;if(this.m_textHeight=this.m_textWidth=0,x.fontPool[this.m_font]){for(this.displayNum=this.m_text.length;i<this.displayNum;i++){null==(r=this.displayList[i])&&(this.displayList[i]=r=h.get(_)),r.skin=x.fontPool[this.m_font][this.m_text[i]],r.x=this.m_textWidth,this.m_textWidth+=r.width+this.m_spacing}for("right"==this.m_align&&(e=this.width-this.m_textWidth),"center"==this.m_align&&(e=this.width-this.m_textWidth>>1),i=0;i<this.displayNum;i++){(r=this.displayList[i]).x+=e}}for(;i<s;i++){var r;(r=this.displayList[i]).free(),h.set(_,r),this.displayList.splice(i,1),i--,s--}}get spacing(){return this.m_spacing}set spacing(t){this.m_spacing=t}get lineHeight(){return this.m_lineHeight}set lineHeight(t){this.m_lineHeight=t}get spaceWidth(){return this.m_spaceWidth}set spaceWidth(t){this.m_spaceWidth=t}get align(){return this.m_align}set align(t){this.m_align=t}get valign(){return this.m_valign}set valign(t){this.m_valign=t}}x.fontPool={},i.registerClass(x,"SpriteFont");class f{static playSound(t,i){var s=f.soundPool[t];null==s&&(s=f.soundPool[t]=new Audio(t)),s.play()}static stopSound(t){}static playMusic(t,i=-1){var s=new Audio(t);s.loop=-1==i,s.play(),f.musicPool[t]=s}static stopMusic(t){}}f.soundPool={},f.musicPool={},i.registerClass(f,"SoundMgr"),i.current=new i.BYGL,i.power=function(t,s,e=!0,r=null,a=null){i.current.init(t,s,a,e,r)},i.bgColor=function(t){i.current.G_a=(t>>24&255)/255,i.current.G_r=(t>>16&255)/255,i.current.G_g=(t>>8&255)/255,i.current.G_b=(255&t)/255},i.Instantiate=function(t){var s=new t;return s instanceof d&&i.current.root.addChild(s),s},i.Destroy=function(t,i=0){null!=t.free&&(i>0?setTimeout(()=>{t.free()},i):t.free())},i.loadFont=function(t,i,s,e=""){m.load(t,o.create(this,function(r){for(var a=t.split(".")[0],h=r.width/i|0,o=-1,n=x.fontPool[t]={},l=0;l<e.length;l++){var u=l%h;0==u&&o++;var d=new c(r),m=u*i/d.width,p=o*s/d.height,_=m+i/d.width,g=p+s/d.height;d.uv[0]=m,d.uv[1]=p,d.uv[2]=_,d.uv[3]=p,d.uv[4]=m,d.uv[5]=g,d.uv[6]=_,d.uv[7]=g,d.url=a+"/"+e[l],d.width=i,d.height=s,c.atlas[d.url]=d,n[e[l]]=d.url}}))}}(window);